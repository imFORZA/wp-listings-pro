var listing_image_gallery_frame=new Object,image_gallery_link=".add_listing_images",image_gallery_id="#listing_image_gallery",image_gallery_container="#listing_images_container",image_gallery_listing="ul.listing_images",image_types=["png","jpg","jpeg","gif","svg"],listing_doc_gallery_frame=new Object,doc_gallery_link=".add_listing_docs",doc_gallery_id="#listing_doc_gallery",doc_gallery_container="#listing_docs_container",doc_gallery_listing="ul.listing_docs",doc_types=["doc","docx","xls","xlsx","pdf"],selected="";function foobar_gallery_popup(e,t,i,n,l,a,r){void 0===r&&(r=[]),void 0===a&&(a=!1);var s=jQuery(i),o=jQuery(n).find(l);jQuery(t).on("click","a",function(t){var i=jQuery(this);t.preventDefault(),e.a?e.a.open():(e.a=wp.media.frames.listing_image_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]}),e.a.on("select",function(){var t=e.a.state().get("selection"),n=s.val();t.map(function(e){if((e=e.toJSON()).id&&a){var t=e.url.split(".")[e.url.split(".").length-1];if(1!=(s=check_types(r,t)))return void wrong_filetype(s);n=n?n+","+e.id:e.id;var l=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;o.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+l+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}else if(e.id){var s,c;t=e.url.split(".")[e.url.split(".").length-1].toLowerCase();if(1!=(s=check_types(r,t)))return void wrong_filetype(s);n=n?n+","+e.id:e.id,c="xls"==t||"xlsx"==t?"/wp-includes/images/media/spreadsheet.png":"/wp-includes/images/media/document.png",o.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+c+'" /><div class="filename"><div>'+e.filename+'</div></div><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),s.val(n)}),e.a.open())}),jQuery(n).find(l).sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6 ")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var e="";jQuery(image_gallery_container).find("ul li.image").css("cursor","default").each(function(){var t=jQuery(this).attr("data-attachment_id");e=e+t+","}),s.val(e)}}),jQuery(n).on("click","a.delete",function(){jQuery(this).closest("li.image").remove();var e="";return jQuery(n).find("ul li.image").css("cursor","default").each(function(){var t=jQuery(this).attr("data-attachment_id");e=e+t+","}),s.val(e),jQuery("#tiptip_holder").removeAttr("style"),jQuery("#tiptip_arrow").removeAttr("style"),!1})}function wrong_filetype(e){jQuery(".wrong-filetype").remove(),jQuery('<div class="notice notice-error wrong-filetype"><h2>'+e+"</h2></div>").insertAfter(jQuery(".wp-header-end")),jQuery("html, body").animate({scrollTop:0},"fast")}function check_types(e,t){for(var i=0;i<e.length&&t!=e[i];i++)if(i===e.length-1){for(var n="Only files ending with a ",l=0;l<e.length;l++)l===e.length-1&&1!==e.length&&(n+=" or "),n+=e[l],l!==e.length-1&&2!==e.length&&(n+=", ");return n+=" extension are accepted in this field."}return!0}jQuery(document).ready(function(e){function t(){jQuery("#wplpro_idx_update_custom").attr("checked")?jQuery("#wplpro_custom_inputs").attr("disabled",!1):jQuery("#_listing_sync_update_custom").attr("checked")?jQuery("#listing_custom_inputs").attr("disabled",!1):(jQuery("#wplpro_custom_inputs").attr("disabled",!0),jQuery("#listing_custom_inputs").attr("disabled",!0))}foobar_gallery_popup(listing_image_gallery_frame,image_gallery_link,image_gallery_id,image_gallery_container,image_gallery_listing,!0,image_types),foobar_gallery_popup(listing_doc_gallery_frame,doc_gallery_link,doc_gallery_id,doc_gallery_container,doc_gallery_listing,!1,doc_types),jQuery("#wplpro_custom_inputs").attr("disabled",!0),jQuery(".notice.is-dismissible").on("click",".notice-dismiss",function(e){e.preventDefault();var t=jQuery(this);t.parent().data("key")&&jQuery.post(wp_listings_adminL10n.ajaxurl,{action:"WPLPRO_Admin_Notice",url:wp_listings_adminL10n.ajaxurl,nag:t.parent().data("key"),nonce:wp_listings_adminL10n.othernonce||""})}),jQuery(document).on("click",".submit-imports-button",function(e){e.preventDefault();for(var t=jQuery(".selected").contents(),i=[],n=0;n<t.length;n++)t[n].id&&(i[i.length]=t[n].id);i=i.join(","),jQuery.ajax({type:"get",dataType:"json",url:"/wp-json/wp-listings-pro/v1/import-listings/?mlses="+i,data:{mlses:i},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wp_listings_adminL10n.nonce)},success:function(e){window.location.reload(),console.log(e)},error:function(e){console.log(e)}})}),jQuery(".idx-import-option").on("click",function(e){setTimeout(t,100)}),setTimeout(t,100),jQuery(".notice.is-dismissible").each(function(){if(!wp_listings_adminL10n.wp_version){var e=jQuery(this),t=jQuery('<button type="button" class="notice-dismiss"><span class="screen-reader-text"></span></button>'),i=wp_listings_adminL10n.dismiss||"";t.find(".screen-reader-text").text(i),e.append(t),t.on("click.wp-dismiss-notice",function(t){t.preventDefault(),e.fadeTo(100,0,function(){jQuery(this).slideUp(100,function(){jQuery(this).remove()})})})}}),setTimeout(function(){jQuery(function(){jQuery("img.lazy").lazyload({event:"scrollstop"})})},600);var i,n,l,a=jQuery(".grid");a.imagesLoaded(function(){a.masonry({columnWidth:".grid-sizer",itemSelector:".grid-item"})}),jQuery(document).on("click",".delete-listing",function(){var e=jQuery(this),t=e.data("id");e.parents(".post:first"),jQuery(".grid").masonry({columnWidth:".grid-sizer",itemSelector:".grid-item"});jQuery.ajax({type:"post",dataType:"json",url:"/wp-json/wp-listings-pro/v1/delete-listing/?id="+t,data:{id:t},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wp_listings_adminL10n.nonce)},success:function(t){e.parent().removeClass("imported selected"),e.parent().find("input.checkbox").removeAttr("checked"),e.parent().find("span.imported").remove(),e.remove()},error:function(e){console.log(e)}})}),jQuery(document).on("click","#sync-idx-settings-now",function(e){console.log(e),e.preventDefault(),jQuery.ajax({type:"get",dataType:"json",url:"/wp-json/wp-listings-pro/v1/sync-all",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wp_listings_adminL10n.nonce)}}),window.location.reload()}),jQuery(document).on("click",".delete-agent",function(){var e=jQuery(this),t=e.data("id"),i=e.data("nonce");e.parents(".post:first"),jQuery(".grid").masonry({columnWidth:".grid-sizer",itemSelector:".grid-item"});jQuery.ajax({type:"post",url:"admin-ajax.php?action=impa_idx_agent_delete&id="+t+"&nonce="+i,data:{action:"impa_idx_agent_delete",nonce:i,id:t},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wp_listings_adminL10n.nonce)},success:function(t){e.parent().parent().removeClass("imported selected"),e.parent().parent().find("input.checkbox").removeAttr("checked"),e.parent().find("span.imported").remove(),e.remove()},error:function(e){console.log(e)}})}),jQuery(document).on("click",".delete-all",function(){var e=confirm("This will delete all imported listings and their attached images. Are you sure you want to continue?"),t=jQuery(this).data("nonce");jQuery("#selectable").find(".selected"),jQuery(".grid").masonry({columnWidth:".grid-sizer",itemSelector:".grid-item"});if(!0!==e)return!1;jQuery.ajax({type:"post",url:"admin-ajax.php?action=wp_listings_idx_delete_all&nonce="+t,data:{action:"wp_listings_idx_listing_delete_all",nonce:t},success:function(e){}})}),jQuery("li").each(function(){jQuery(this).find(":checkbox").attr("checked")&&jQuery(this).addClass("selected")}),jQuery(".idx-listing :not('.imported') .checkbox").click(function(e){var t=jQuery(this).attr("checked");jQuery(this).closest("li").toggleClass("selected",t)}),jQuery(".idx-listing .imported .checkbox").click(function(e){e.preventDefault()}),jQuery(".idx-agent :not('.imported') .checkbox").click(function(e){var t=jQuery(this).attr("checked");jQuery(this).closest("li").toggleClass("selected",t)}),jQuery(".idx-agent .imported .checkbox").click(function(e){e.preventDefault()}),jQuery("#selectall").change(function(){""===selected?(jQuery(".checkbox").prop("checked",!0),jQuery(".idx-listing li").removeClass("selected").addClass("selected"),jQuery(".idx-agent li").removeClass("selected").addClass("selected"),selected="y"):(jQuery(".checkbox").prop("checked",!1),jQuery(".imported .checkbox").prop("checked",!0),jQuery(".idx-listing li").removeClass("selected"),jQuery(".idx-agent li").removeClass("selected"),selected="")}),i=jQuery.event.special,n="D"+ +new Date,l="D"+(+new Date+1),i.scrollstart={setup:function(){var e,t=function(t){var n=arguments;e?clearTimeout(e):(t.type="scrollstart",jQuery.event.handle.apply(this,n)),e=setTimeout(function(){e=null},i.scrollstop.latency)};jQuery(this).bind("scroll",t).data(n,t)},teardown:function(){jQuery(this).unbind("scroll",jQuery(this).data(n))}},i.scrollstop={latency:300,setup:function(){var e,t=function(t){var n=this,l=arguments;e&&clearTimeout(e),e=setTimeout(function(){e=null,t.type="scrollstop",jQuery.event.handle.apply(n,l)},i.scrollstop.latency)};jQuery(this).bind("scroll",t).data(l,t)},teardown:function(){jQuery(this).unbind("scroll",jQuery(this).data(l))}}});